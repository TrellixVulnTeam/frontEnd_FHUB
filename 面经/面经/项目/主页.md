整个项目的布局用的LayUI，然后进行了自己的设计和修改。主页这块，大盒子用的标准流盒子占位设置了高度，盒子里面用的浮动布局，这边是左浮，时间显示用了setInterval，在回调函数里new一个Date实例，然后利用实例调用方法获得当前时间的年月日时分秒，组合成字符串，放入节点中。这个字体图标有一个功能就是展开或者收缩侧边栏。为了实现功能，侧边栏和主要内容都用到了定位，点击的时候，侧边栏从left0到一个left负的侧边栏宽度，主要内容从left正的侧边栏宽度到left0，同时为了移动比较平滑，用到了transition过渡。右边用到了Layui的nav导航栏组件，让其右浮动，鼠标经过，显示二级菜单，这个二级菜单通过z-index让其可以压住其它元素节点，显示出来。一些小细节的样式，比如字体图标还是得自己去设计。点击弹出内嵌页面用到了LayUI的layer弹出层模块，这些都是提前在另外一个php中写好了，然后将url作为layer模块的content参数就可实现该效果，弹出层的宽度和高度也都是可以自己设定。

主体部分用了定位进行布局，左边的导航栏是自己设计的，整体是一个ul，里面每一个模块都是一个小li，点击小li的时候得先判断它是不是已经展开的状态，已展开的小li会有一个独特的类名open通过这个可以判断，如果是已展开的状态，我们就要进行收缩子菜单，用slideup使用滑动效果隐藏子菜单；如果不是已展开的状态，添加类名open，然后我们要找到它展开了的兄弟节点，移除兄弟节点的open类名，并且将兄弟节点的子菜单用slideup滑动隐藏，然后利用slidedown使用滑动效果显示被选元素。同时我们的项目是针对于商场的工作人员，工作人员的职位都不同，有些功能是只能特定人员使用的，所以我们在登录时不仅会保存用户的ID还有用户的级别，然后在主页根据用户的级别，导航栏有些是不会显示的。

二级菜单里，当前菜单有个menu-current类名，点击了之后，要移除兄弟节点的这个类名，然后再给自身添加类名。

右边的选项卡用到了LayUI的Tab模块并进行了一些小修改，每点击左边的导航栏就会检查Tab里是否已经存在了对应的选项卡(每一个小li都会有一个独一无二的id，每次创建新选项卡的时候，将这个id作为参数之一，layUI会帮助我们把这个id放置在对应选项卡的lay-id属性里。这样每次点击的时候就拿到这一部分的所有选项卡，然后对比看哪个的lay-id等于该小li的id)，有的话就通过layUI提供的API输入lay-id，会帮助我们进行切换；没有就需要创建新的选项卡，新选项卡对应的页面url是在小li的某个属性中，因此我们获取该属性，作为iframe的内联网页地址，将小li的id和iframe作为参数调用LayUI的api创建新的选项卡。

页面的具体内容基本上都是用LayUI的表单组件和表格组件以及页码组件完成的。前端设计好界面给后端接口，后端在页面一加载的时候就去查询数据库拿到数据集，将数据放入接口中；切换页面就是获取当前的页码和每页的数据得到下一页数据在数据库中的具体位置，然后去数据库查；查询就是获取表单数据，然后php通过mysqli_query去数据库里查询，mysqli_fetch_rows拿到结果集，然后重新渲染这个页面

整个数据的流向是这样的，首先是供应商管理，了解有哪些供应商，供应商供应了哪些商品，这样才能够进行价格的比对以及出问题时的溯源。页面一加载的时候，默认页码是1，每一页有5条数据，用mysqli去数据库拿到前5条数据，遍历数据放入前端的接口中；页面的跳转，会重新刷新这个页面并用GET的方式传输跳转到的页码和每一页的数据条数，这样才能够在数据库中找到对应的那一段数据，即从数据库的哪一行开始取多少条数据，比如说第2页，那就是从数据库的第6行开始取5条数据；在搜索这一块，输入编号提交表单后，会进入另外一个php，这个php通过编号查询在数据库的具体位置，就是多少条，然后就可以通过页码大小计算出在那一页，接着重新进入这个页面并用GET的方式传输跳转到的页码和每一页的数据条数，从而实现搜索；点击添加供应商就会出现这个弹出层，用layui的layer模块实现的，弹出层的内容也是另外一个php。*号都是必填数据，并且每个有一些字段会通过正则表达式来进行验证是否符合规则；点击编辑也是另外一个php，在点击的时候会把这些数据通过GET方式传递给这个php，php直接拿到数据就放在前端设置的接口里即可；删除功能也是通过把id给到php，php操作数据库进行删除，但这里我们也设置了一些逻辑，就是已经有采购记录的，是不能够随意删除的，因为没法溯源。

然后是供应批次，这里的页面和刚刚是差不多的，这里就是我在更深入的学习后觉得可以改进的地方。当时是直接就复制粘贴了前面的代码，然后进行微调。实际上完全可以组件化，然后进行复用。因为确实相差无几。供应批次决定了我能够采购哪些东西。

接着就是采购模块，有了供应批次后，决定采购哪些东西。在这里比较困难的实现是这个联动。供应商和生产批号，以及采购单价是需要根据商品的选择来决定的。商品决定了供应商的可选项，选择了商品和供应商，决定了供应批次的可选项，这三个都选择了之后，单价应当自动填充。这一部分联动实现是当时特别困扰的难点，当时有考虑过使用表单提交，但这样每选择一个选项，就得通过GET方式重新进入该php效果不太好。layUI可以局部刷新的表单类型里有下拉框，所以用layUI的API来进行了局部刷新。然后我们得考虑数据的更新，首先拿到produce视图里的所有数据，然后进行整合成对象。每一个对象有两个属性，第一个属性是商品的ID和name的组合，第二个属性是一个数组，存储所有供应商的名字和生产批号

``` javascript
{
    name: '000001百事可乐',
    supplierList: [
        {
           suppliername: '300001饮品供应商',
            produceList: [{
                id: 20191111,
                price: 1.0
            },{
                id: 20191112,
                price: 1.5
            }]
        },
        {
            suppliername: ''
            produceList: []
        }
    ]
}
```

监听下拉框的选择，在选择商品后。遍历数组找到与选择的商品对应的对象，将supplierList存储并遍历，将每个供应商的name加入到下拉框里。选择了供应商后，遍历存储的供应商找到与选择的供应商对应的对象，存储produceList并遍历加入到下拉框里。 选择了批次后，price自然就是直接对应了。

采购完可以查看采购明细，这边都是比较基本的展示，日期用到了Layui的date组件，数据库里存储的就是这个date形式，所以直接去数据库里根据选择的范围查找即可，然后遍历数据集，将数据放在接口上即可；点击采购详细这里也是用到了弹出层，是另外一个PHP,会用GET的方式给这个php传递具体的单号和日期，这样就能去数据库查询然后将拿到的数据进行渲染。

采购之后要进行入库，如果商品上架要进行出库。这里主要是用到了触发器，在输入入库单和出库单的时候，不仅记录详细的信息，还会自动更新库存，入库的时候也会验证仓库容量是否足够，出库的时候会验证商品上架数量是否小于等于商品库存。

接着可以开始销售了，显示商品列表，商品的具体信息，以及商品的折扣。前台界面的逻辑是差不多的，但是比如说我们得考虑到商品如果产生了交易订单是不能被轻易删除的，添加商品的时候，ID不能重复，且要符合规则

在盈亏状况这一块的图像是主要用到了echarts，到统计量，因为我们是将每日的销售额和利润等等都存储到了一个表格里。总量可以直接用mysql语句select sum就能拿到和的数据。每一个图表都准备了一个DOM，然后用绝对定位排列。初始化一个echarts实例，然后指定图表的配置和数据。

页面的布局是可以复用的，利用UI布好局之后，可以很多模块可以用这个UI界面，但是逻辑却不一样。每个模块的变动会影响哪些模块，该表项能不能删除，每个模块的操作会受到哪些模块的限制。这些是比较麻烦的。这是一整个数据流向，这个是我们出bug非常多的地方，也是非常麻烦的地方。我现在也是不敢保证这个系统完全没有问题，只能是尽可能地考虑到了许多因素，以及模块之间的限制。
