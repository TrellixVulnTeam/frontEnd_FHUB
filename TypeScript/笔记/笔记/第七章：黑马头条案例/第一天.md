##  0、接口说明

- 获取频道列表:[geek.itheima.net/v1_0/channels](http://geek.itheima.net/v1_0/channels)
- 获取频道新闻：http

## 1、创建黑马头条项目

1. 利用脚手架初始化项目

   1. ``` bash
      npx create-react-app heima --template typescript  
      ```

2. 删除多余文件，将模板进行导入

## 2、创建类型声明文件

- 为了让案例代码结构逻辑清晰，推荐将Redux相关功能的类型抽离到单独的类型声明文件中统一处理。
- 按照职责划分为两个类型声明文件：
  1. `store.d.ts`：Redux的action、state等类型。负责仓库action的类型定义
  2. `data.d.ts`：接口相关数据的类型、reducer 处理状态的类型。负责数据结构类型的定义
- 步骤
  1. 在src目录中创建types目录
  2. 在types目录中创建以上两个文件

## 3、初始化redux

### 3.1 安装redux

``` bash
yarn add redux react-redux redux-devtools-extension redux-thunk
```

- 最后一个包是为了异步，倒数第二个包是为了调试redux

### 3.2 初始化store

- 步骤

  1. 在src目录中创建store目录

  2. 在store目录下新建`index.ts`文件

     1. ``` typescript
        import { createStore, applyMiddleware } from 'redux'
        import thunk from 'redux-thunk'
        import { composeWithDevTools } from 'redux-devtools-extension'
        // 引入reducer
        import rootReducer from './reducer'
        
        // 创建store
        const store = createStore(rootReducer, composeWithDevTools(applyMiddleware(thunk)))
        type RootState = ReturnType<typeof store.getState>;
        export type {RootState}
        export default store
        ```

### 3.3 初始化reducer

- 步骤

  1. 在store目录下创建reducer目录

  2. 在reducer目录下新建`index.ts`文件作为rootReducer汇总各个reducer

     1. ``` typescript
        import { combineReducers } from "redux";
        
        // 对象里写reducer的名字，和对应的reducer
        const rootReducer = combineReducers({})
        export default rootReducer
        
        ```

### 3.4 将store与组件连接

- 步骤

  1. 在src/index.ts文件里

  2. 引入对应文件

     1. ``` typescript
        import React from 'react';
        import ReactDOM from 'react-dom/client';
        import App from './App';
        import { Provider } from 'react-redux';
        import store from './store';
        
        const root = ReactDOM.createRoot(
          document.getElementById('root') as HTMLElement
        );
        root.render(
          <Provider store={store}>
            <App />
          </Provider>
        );
        
        ```

     2. 

## 4、声明类型

>需要声明基本数据类型，和action的类型

### 4.1  声明基本数据类型

- 步骤

  1. 首先==确认我们要用到的数据==有两种：频道与文章

  2. 根据要求==搜集这两种的数据格式==

  3. 根据搜集到的数据，在`src/types/data.d.ts`中进行声明

     1. ``` typescript
        // . 负责数据结构类型的定义
        
        // 1. 声明频道的数据结构
        export type Channels = {
            id: number,
            name: string
        }[]
        
        // 2. 声明文章的数据结构
        export type Articles = {
            art_id: string,
            title: string,
            aut_id: string,
            comm_count: number,
            pubdate: string,
            aut_name: string,
            is_top: number,
            cover: {
                type: number,
                images?: string[] //images可能没有
            }
        }[]
        ```


### 4.2 声明action类型

- 有三种action：1.获取频道列表action；2.切换当前频道action；3.获取该频道对应的文章列表action

#### 4.2.1 获取频道列表action

- 获取所有频道的信息。注意这里的代码逻辑是：==发送请求到服务器获取所有频道列表的信息，然后将这些信息存到redux的state中==。所以此时这个action需要携带这些信息数据（数组）。

  - ``` typescript
    // 负责仓库action的类型定义
    import type {Channels} from './data'
    
    // 获取频道列表action 类型
    type getChannelAction = {
        type: 'channel/get',     //字面量
        payload: Channels           //从后端获取频道列表 => 载荷数据 => 频道列表数据
    }
    ```

#### 4.2.2 切换当前频道action

- 切换频道只需要频道的id

  - ``` typescript
    // 切换当前频道action 类型
    type toggleChannel = {
        type: 'toggle',
        payload: number
    }
    
    ```

#### 4.2.3 获取该频道对应的文章列表action

- 获取频道对应的所有文章列表的信息。注意这里的逻辑是：==先发送请求拿到文章列表的数据，再将该数据存于redux的state中==。所以此时这个action需要携带这些信息数据

  - ``` typescript
    // 负责仓库action的类型定义
    import type {Channels, Articles} from './data'
    
    
    // 获取对应频道的文章列表action 类型
    type getArticle = {
        type: 'get',
        payload: Articles
    }
    ```

  - 

### 4.3 声明ThunkAction

- 因为项目涉及ajax请求，这是异步的，所以需要指明ThunkAction类型
- 个人感觉thunkAction格式是固定的，没有什么变化，更像是在告诉store这是一个异步action。

``` typescript
import type {RootState} from '../store'

type RootAction = getChannelAction | toggleChannelAction | getArticleAction
export type RootThunkAction = ThunkAction<void, RootState, unknown, RootAction>
```

