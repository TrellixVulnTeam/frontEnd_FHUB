# 闭包

## 1. 闭包的三个特性

**①函数嵌套函数
②`函数内部可以引用函数外部的参数和变量`
③`参数和变量不会被垃圾回收机制回收`**

**`闭包之间是相互独立的`**

## 2. 闭包经典例子

![image-20220127135228033](C:\Users\zayn\AppData\Roaming\Typora\typora-user-images\image-20220127135228033.png)

一般情况下，在`函数fn执行完后，就应该连同它里面的变量一同被销毁`，

但是在这个例子中，`匿名函数作为fn的返回值被赋值给了fn1`，这时候相当`于fn1=function(){var n = 0 … }`，并且`匿名函数内部引用着fn里的变量num`，所以**`变量num无法被销毁`**，

`函数 fn 在执行完以后虽然会立即销毁`，但它内部的`匿名函数在创建的时候就会随之创建一个特殊的容器`，用于`保存上层作用域中变量的引用`，`所以foo 函数中的 num 并不会销毁`，当`执行第一次 fn() 时，会创建 fn() 对应的作用域`，其中num 会从之前创建的特殊的容器中取出上层作用域中变量的值，而 n 会立即声明一个，当函数执行完毕后，就会销毁对应的作用域，此时 n 也会随之销毁，但变量 fn 对应的指针地址不会变，当再次执行 fn() 时，又会再创建一个 fn() 对应的作用域，num 还是会从上层作用域中拿，但 age 还是会重新声明，使用完后还是会被销毁。

而**`变量n是每次被调用时新创建的`**，没有在除匿名函数的其它地方被使用，`所以每次fn1执行完后它就把属于自己的变量连同自己一起销毁`，于是乎最后就剩下孤零零的num，于是这里就产生了内存消耗的问题

## 3. 闭包的好处与坏处

### 3.1 好处

①保护函数内的变量安全 ，实现封装，防止变量流入其他环境发生命名冲突

②在内存中维持一个变量，可以做缓存（但使用多了同时也是一项缺点，消耗内存）

③匿名自执行函数可以减少内存消耗

### 3.2 坏处

①其中一点上面已经有体现了，就是被引用的私有变量不能被销毁，增大了内存消耗，造成内存泄漏，解决方法是可以在使用完变量后手动为它赋值为null；

②其次由于闭包涉及跨域访问，所以会导致性能损失，我们可以通过把跨作用域变量存储在局部变量中，然后直接访问局部变量，来减轻对执行速度的影响