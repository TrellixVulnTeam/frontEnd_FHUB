## 1.具体讲讲 `fiber` 机制

是一套新的更新机制

react`更新渲染有两个阶段`，一个是`渲染`阶段，一个是`commit`阶段

在渲染阶段中，`React会更新数据生成新的虚拟DOM`，然后利用`diff`算法将新生成的虚拟DOM和上一次的虚拟DOM进行对比，`找到需要更新的元素，放到更新队列中`，同时记录commit阶段要执行的生命周期函数

在commit阶段中，`React会遍历更新队列`，`将所有的更新一次性同步到真实DOM`上。并执行生命周期函数。



之前的更新组件只有两层，一层是`Reconciler调和器`，`一层是render渲染器`。调和器负责找出变化的组件，渲染器负责更新。但调和器是采用递归的方式去查找变化的组件且这个过程不能被打断。如果是一个很大的项目，很容易卡住页面。



所以诞生了三层的更新组件，一层是scheduler调度器，一层是Reconciler调和器，一层是render渲染器。调度器负责调度任务的优先级，优先级高的任务先执行。协调器内部采用了Fiber的架构，`从递归变成了可以中断的循环过程`。每个元素都会有一个fiber对象对应。这些fiber对象之间相互关联。react fiber的`更新过程是碎片化`的，`一次更新会分为n个任务片`。`每个片执行完成后就会把控制权交给调度器`。`调度器会查看浏览器是否有级别更高的任务`（比如：alert，onclick，等），如果`有就执行这个高级别任务`，如果`没有继续执行fiber更新`。

