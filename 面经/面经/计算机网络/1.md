## 1.输入一个url发生了什么（描述一次完整的 HTTP 事务）

http://www.baidu.com,这个域名由三部分组成：`协议名`、`域名`、`端口号`，这里端口是默认所以隐藏

1. **`域名解析`**---通过`DNS`服务器对域名进行解析，拿到对应的 IP 地址。`真正访问一个计算机是通过计算机的IP地址进行访问`，但是由于IP地址不好记，用户体验不好，所以就出现"域名"。域名只是与IP地址的一个映射

2. **`建立TCP连接`**---经历`三次握手`，来建立 TCP 连接。

   2.1 第一次握手：`客户端`发送一个带有`SYN(连接请求或连接接受报文)标志的数据包`给`服务端`，我想要给你发送数据，你现在处于正常工作状态吗？

   2.2 第二次握手：`服务端`收到后，`回传`一个带有`SYN/ACK标志的数据包`以示传达确认信息。我当前处于正常工作状态，你可以给我发送数据。

   2.3 第三次握手：最后`客户端再回传一个带ACK标志的数据包`，代表`握手结束，连接成功`。 浏览器通知服务器：好的，我知道了，我要开始发送数据了。

3. **`浏览器发送请求、服务端处理请求`**

   -    TCP 连接成功后，浏览器就可以`通过 http 协议`来向服务器发起请求。
   -    服务器接收到请求后，开始处理请求。处理完成后将结果返回给浏览器。

4. **`关闭 TCP 连接`**--- 客户端接收到服务端发送的数据后，需要通过TCP协议来断开与服务器的连接。经历`四次挥手`，来关闭 TCP 连接。

   - 第一次挥手：`客户端`发送完数据后，向服务端发送一个`请求终止连接 FIN 报文`主动关闭 TCP 连接。我的东西已经发送完成了，我想要断开连接，可以吗？
   - 第二次挥手：`服务端`发送` ACK 报文`，表明已经收到客户端的报文。此时的 TCP 处于半关闭状态，`客户端到服务端的连接释放`你等会儿，我这边还有数据没有发送完成。
   - 第三次挥手：`服务端`发送完数据后，向客户端发送一个请求终止连接 FIN 报文，服务器告诉客户端：我现在处理完成了，可以关闭连接了。
   - 第四次挥手：`客户端`收到 FIN 报文后，会`发送 ACK 报文`。好的，我知道了。

   三次握手和四次挥手都是为了确保数据传递的安全性和完整性。四次挥手后，会等一会儿，确定服务器没有东西传过来，浏览器会断开连接。

5. **`浏览器渲染页面`**---浏览器接收到服务器发送过来的资源数据后，开始对数据进行解析渲染等操作。浏览器通过解析HTML，生成DOM树，解析CSS，生成CSS规则树，然后通过DOM树和CSS规则树生成渲染树。



## 2.跨域的原因

**`浏览器的同源策略`**：当我们在`一个源（域）`中，`向另一个源（域）发起请求`时，两个源之间的`协议、IP、端口三者必须一致`，则为同源。（`页面`地址和`页面中的请求`的地址、协议、IP、端口三者必须一致。如果`协议、IP、端口`三者中，`有一个不一致`，则为行为`跨域`。浏览器在默认情况下，是`不允许跨域的`。一旦跨域，浏览器就会出现以下报错

``` bash
http://www.woniuxy.com/tc
协议 + 计算机IP + 端口号
```



## 3.解决跨域的办法

### 3.1 JSONP

- `发送请求的源`的前端在 jQuery 的 ajax 中添加一个 dataType 属性，值为 `jsonp`：

``` javascript
$.ajax({
    url: 'http://localhost:3000/students/getStudents',
    type: 'get',
    dataType: 'jsonp',
    success(msg) {

    }
})
```

- 在`接收请求的源`的后端将响应 `res.send()` 改成 `res.jsonp()`：

``` javascript
router.get('/getStudents', async function (req, res) {
    const data = await getStudents(req.query);
    res.jsonp(data);
})
```

- JSONP 的方式`只能处理 GET` 请求类型的跨域。



### 3.2 CORS